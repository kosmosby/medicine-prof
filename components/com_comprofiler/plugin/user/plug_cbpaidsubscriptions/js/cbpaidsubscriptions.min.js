(function($){var cbpaySels;var cbpayFirstTimeDone=false;var cbpayPlansConds=[];function paidsubsChange(e){var fieldsToShow=new Array();var fieldsToHide=new Array();var r=new RegExp("^cbpplan[EN]\\[(\\d+)\\]\\[selected\\]\\[\\]$","");if(!cbpayFirstTimeDone){cbpaySels.each(function(i){if($(this).prop("checked")||(($(this).attr("type")=="hidden")&&($(this).val()>0))){$(this).attr("cbsubschkdef","1")}});cbpaySels.each(function(i){var iPlan=r.exec($(this).attr("name"));if(iPlan[1]=="0"){if($(this).prop("checked")||(($(this).attr("type")=="hidden")&&($(this).val()>0))){cbpaySels.filter("[name='cbpplanE["+$(this).val()+"][selected][]'],[name='cbpplanN["+$(this).val()+"][selected][]']").filter(function(){return($(this).attr("cbsubschkdef")=="1")}).attr("checked",true)}}else{if(cbpaySels.filter("[value='"+parseInt(iPlan[1])+"']").filter("[name='cbpplanE[0][selected][]'],[name='cbpplanN[0][selected][]']").prop("checked")==""){$(this).prop("checked",false)}}})}else{var clickedObject=$(typeof(e)!="undefined"?(typeof(e.target)!="undefined"?e.target:e):"");var clickedPlan=r.exec(clickedObject.attr("name"));if(clickedPlan!==null){if(clickedPlan[1]=="0"){if(clickedObject.prop("checked")){cbpaySels.filter("[name='cbpplanE["+clickedObject.val()+"][selected][]'],[name='cbpplanN["+clickedObject.val()+"][selected][]']").filter(function(){return($(this).attr("cbsubschkdef")=="1")}).prop("checked",true)}}else{var p=cbpaySels.filter("[value='"+parseInt(clickedPlan[1])+"']").filter("[name='cbpplanE[0][selected][]'],[name='cbpplanN[0][selected][]']");if($(this).prop("checked")==true){p.prop("checked",true)}}}}cbpaySels.each(function(i){var iPlan=r.exec($(this).attr("name"));if((iPlan[1]=="0")&&($(this).val()!="0")&&(!$(this).prop("checked"))){cbpaySels.filter("[name='cbpplanE["+$(this).val()+"][selected][]'],[name='cbpplanN["+$(this).val()+"][selected][]']").prop("checked",false)}});cbpaySels.each(function(i){if($(this).prop("checked")||(($(this).attr("type")=="hidden")&&($(this).val()>0))){fieldsToHide=fieldsToHide.concat(cbpayHideFields[$(this).val()]);$(this).closest(".cbregPlanSelector").find(".cbRegNameDesc").find(":not(.cbregSubPlanSelector) .fieldCell input.requiredDisabled,:not(.cbregSubPlanSelector) .fieldCell select.requiredDisabled").removeClass("requiredDisabled").addClass("required")}else{fieldsToShow=fieldsToShow.concat(cbpayHideFields[$(this).val()]);$(this).closest(".cbregPlanSelector").find(".cbRegNameDesc").find(":not(.cbregSubPlanSelector) .fieldCell input.required,:not(.cbregSubPlanSelector) .fieldCell select.required").removeClass("required").addClass("requiredDisabled")}});for(var i=0;i<fieldsToShow.length;i++){var fieldToShow=$("#cbfr_"+fieldsToShow[i]+",#cbfrd_"+fieldsToShow[i]+",#cbfr_"+fieldsToShow[i]+"__verify");if(cbpayFirstTimeDone&&!fieldToShow.parent().is(":hidden")){fieldToShow.fadeIn("slow")}else{fieldToShow.show()}fieldToShow.find(".fieldCell,.cb_field").removeClass("requiredDisabled").find(".requiredDisabled").removeClass("requiredDisabled").addClass("required").attr("mosReq","1")}for(var i=0;i<fieldsToHide.length;i++){var fieldToHide=$("#cbfr_"+fieldsToHide[i]+",#cbfrd_"+fieldsToHide[i]+",#cbfr_"+fieldsToHide[i]+"__verify");if(cbpayFirstTimeDone&&!fieldToHide.parent().is(":hidden")){fieldToHide.fadeOut("slow")}else{fieldToHide.hide()}fieldToHide.find(".fieldCell,.cb_field").addClass("requiredDisabled").find("input.required,select.required,textarea.required").removeClass("required").addClass("requiredDisabled").attr("mosReq","0")}for(var i=0;i<cbpayPlansConds.length;i++){var cond=cbpayPlansConds[i];var pOk=cond.plansReq.length?false:true;for(var j=0;j<cond.plansReq.length;j++){if($("#cbregUpgrades #cbregProduct_"+cond.plansReq[j]+".cbregPlanSelector .cbregTick input").prop("checked")==true){pOk=true;break}}for(var j=0;j<cond.plansNotReq.length;j++){if($("#cbregUpgrades #cbregProduct_"+cond.plansNotReq[j]+".cbregPlanSelector .cbregTick input").prop("checked")==true){pOk=false;break}}var fOk=true;for(var j=0;j<cond.fieldsReq.length;j++){var f=$("#cbfv_"+cond.fieldsReq[j]+" input,#cbfv_"+cond.fieldsReq[j]+" select");if(!(f.prop("checked")==true||((f.attr("type")!="checkbox")&&(f.attr("type")!="radio")&&(f.val()!="")))){fOk=false;break}}for(var j=0;j<cond.fieldsNotReq.length;j++){var f=$("#cbfv_"+cond.fieldsNotReq[j]+" input,#cbfv_"+cond.fieldsNotReq[j]+" select");if(f.prop("checked")==true||((f.attr("type")!="checkbox")&&(f.attr("type")!="radio")&&(f.val()!=""))){fOk=false;break}}if(cond.field1>0){var f=$("#cbfv_"+cond.field1+" input,#cbfv_"+cond.field1+" select");if(f.length>0){var val="";if((f.attr("type")=="checkbox")||(f.attr("type")=="radio")){f.each(function(){if($(this).prop("checked")==true){val=val+(val==""?"":"|*|")+$(this).attr("value")}})}else{if(f.is("select")){val=f.val()||[];if($.isArray(val)){val=val.join("|*|")}}else{val=f.val()}}var op=cond.regexp1[0];if(op=="<"||op=="<"){var c=cond.regexp1.slice(1);if(c.match(/^[0-9.]+$/)){if(val.match(/^[0-9.]*$/)){if(op=="<"){if(!(Number(val)<Number(c))){fOk=false}}else{if(!(Number(val)>Number(c))){fOk=false}}}else{fOk=false}}else{if(op=="<"){if(!(val<c)){fOk=false}}else{if(!(val>c)){fOk=false}}}}else{if(op=="/"){var r=new RegExp(cond.regexp1.slice(1,-1));if(!val.match(r)){fOk=false}}}}}var planTarget=$("#cbregUpgrades #cbregProduct_"+cond.planId+".cbregPlanSelector");if(pOk&&fOk){if(cbpayFirstTimeDone){planTarget.slideDown("slow")}else{planTarget.show()}var targetWasVisible=planTarget.hasClass("cbregDoHideChildrenVisible");planTarget.removeClass("cbregDoHideChildrenHidden").addClass("cbregDoHideChildrenVisible");planTarget.find(".fieldCell input.requiredDisabled,.fieldCell select.requiredDisabled").removeClass("requiredDisabled").addClass("required").attr("mosReq","1");var tick=planTarget.find(".cbregTick input");if((!targetWasVisible)&&(tick.attr("cbsubschkdef")=="1")){tick.prop("checked",true)}}else{if(cbpayFirstTimeDone){planTarget.slideUp("slow")}else{planTarget.hide()}planTarget.removeClass("cbregDoHideChildrenVisible").addClass("cbregDoHideChildrenHidden");planTarget.find(".fieldCell input.required,.fieldCell select.required").removeClass("required").addClass("requiredDisabled").attr("mosReq","0");planTarget.find(".cbregTick input").prop("checked",false)}}$("#cbregUpgrades .cbregDoHideChildren .cbregTick input").each(function(){var subPlans=$(this).closest(".cbregPlanSelector").find(".cbRegNameDesc .cbregSubPlanSelector");if($(this).prop("checked")==true){if(cbpayFirstTimeDone){subPlans.slideDown("slow")}else{subPlans.show()}$(this).closest(".cbregPlanSelector").removeClass("cbregDoHideChildrenHidden").addClass("cbregDoHideChildrenVisible");subPlans.find(".fieldCell input.requiredDisabled,.fieldCell select.requiredDisabled").removeClass("requiredDisabled").addClass("required").attr("mosReq","1")}else{if(cbpayFirstTimeDone){subPlans.slideUp("slow")}else{subPlans.hide()}$(this).closest(".cbregPlanSelector").removeClass("cbregDoHideChildrenVisible").addClass("cbregDoHideChildrenHidden");subPlans.find(".fieldCell input.required,.fieldCell select.required").removeClass("required").addClass("requiredDisabled").attr("mosReq","0")}});cbpaySels.each(function(i){if($(this).prop("checked")){$(this).parents(".cbregPlanSelector").addClass("cbregPlanSelected")}else{$(this).parents(".cbregPlanSelector").removeClass("cbregPlanSelected")}});cbpayFirstTimeDone=true}var donationSelval=[];function paidsubsDonationSelect(){var iNamePrefix=/^([^\[]+)[EN]\[([^\]]+)\]\[donate\]\[plan([^\]]+)\]\[donsel\]$/.exec($(this).attr("name"));$("#"+iNamePrefix[1]+iNamePrefix[3]).prop("checked",($(this).val()!=="")).triggerHandler("click");if($(this).val()==="0"){$(this).closest(".cbregDonationSelect").next("span.cbregDonationValue").fadeIn("slow");if((typeof(donationSelval[$(this).attr("name")])=="undefined")||(!donationSelval[$(this).attr("name")])){$(this).closest(".cbregDonationSelect").next("span.cbregDonationValue").children("input.cbregDonationFreeValue").focus();donationSelval[$(this).attr("name")]=true}}else{$(this).closest(".cbregDonationSelect").next("span.cbregDonationValue").fadeOut("slow");donationSelval[$(this).attr("name")]=false}return true}function paidsubsDonationValueBlur(){if($(this).parents(".cbregDonationValue").slice(0,1).prev("span.cbregDonationSelect").children("select.cbregDonationSelector").val()==="0"){var iNamePrefix=/^([^\[]+)[EN]\[([^\]]+)\]\[donate\]\[plan([^\]]+)\]\[donval\]$/.exec($(this).attr("name"));var isZeroOrEmpty=(/^ *0*\.?0* *$/.test($(this).val()));$("#"+iNamePrefix[1]+iNamePrefix[3]).prop("checked",!isZeroOrEmpty).triggerHandler("click")}return true}function paidsubsDonationValueChangeKeyUp(){$(this).val(/[0-9]*\.?[0-9]*/.exec($(this).val()));return true}var termsChecked=false;function paidsubsTermsAcceptChange(){var paybuttons=$('.cbpayChoices .cbpaidCCbutton form input[type="image"], .cbpayChoices .cbpaidCCbutton form button');if($(this).prop("checked")){paybuttons.removeAttr("disabled");$("#cbregTermsError").fadeOut(function(){$(this).remove()});paybuttons.fadeTo("fast",1)}else{paybuttons.fadeTo(termsChecked?"fast":0,0.3);if(!termsChecked){$(".cbpayChoices").show();$("button#cbTermsAccept").parent().hide();termsChecked=true}paybuttons.click(function(){if(!$("input#terms_accepted").prop("checked")){if($("#cbregTermsError").length==0){$(".cbregTermsAccept").after('<div class="cb_result_warning" id="cbregTermsError">'+$("button#cbTermsAccept").attr("title")+"</div>")}$("#cbregTermsError").fadeIn("slow",function(){$(this).fadeOut(function(){$(this).fadeIn()})});return false}})}}var clickableDesc=true;function paidsubsClickDescription(event){if(clickableDesc){if($(event.target).filter("input,select,label,button,option,a").length==0){clickableDesc=false;var checkboxOfDesc=$(this).find('.cbregTick input[type!="hidden"]').first().filter(":not(:checked)");checkboxOfDesc.prop("checked",true);clickableDesc=true;paidsubsChange(checkboxOfDesc);return false}}return null}function hextobin(hex){var bytes=[];for(var i=0;i<hex.length-1;i+=2){bytes.push(parseInt(hex.substr(i,2),16))}return String.fromCharCode.apply(String,bytes)}var paidsubsInitDone=false;$.extend({cbpaidsubs:{paidsubsInit:function(){if(paidsubsInitDone){return}paidsubsInitDone=true;cbpaySels=$("#cbregUpgrades input").filter(function(index){return/^cbpplan[EN]\[(\d+)\]\[selected\]\[\]$/.test($(this).attr("name"))});paidsubsChange();cbpaySels.click(paidsubsChange);$(document).on("click",".cbregPlanSelector",paidsubsClickDescription);$("#cbregUpgrades select.cbregDonationSelector").change(paidsubsDonationSelect);$("#cbregUpgrades input.cbregDonationFreeValue").blur(paidsubsDonationValueBlur).change(paidsubsDonationValueChangeKeyUp).keyup(paidsubsDonationValueChangeKeyUp);var cbpPMajaxSubmited=false;var ajaxFormOptions={target:$("#cbpayOrderContainer"),type:"POST",beforeSubmit:function(formData,jqForm,options){options.url=hextobin($(jqForm).find('input[name="ajaxurl"]').attr("value"));$("#cbpayOrderContainer>div").fadeTo("fast",0.07).parent().prepend('<div style="position:absolute; z-index:100;" class="cbregAjLoading cbregAjLoadingCentered">&nbsp;</div>').fadeIn("fast")},success:function(responseText,statusText){attachRadios();cbpPMajaxSubmited=false}};function attachRadios(){termsChecked=false;$("input#terms_accepted").each(paidsubsTermsAcceptChange).change(paidsubsTermsAcceptChange);$(".cbregCCradioLi:not(.cbregCCradioSelected)").each(function(){$(this).find(".cbregCCselDescription").hide()}).hover(function(){$(".cbregCCselDescription").stop(true,true);$(this).find(".cbregCCselDescription").slideDown("fast")},function(){$(".cbregCCselDescription").stop(true,true);$(this).find(".cbregCCselDescription").slideUp("fast")});$(".cbregPaymentMethodsSelect form, .cbregCurrencySelect form").ajaxForm(ajaxFormOptions);$("button#cbregSelectPayment, button#cbregSelectCurrency").parent().hide()}attachRadios();$("#cbpayOrderContainer").delegate(".cpayOrderCurrency","change",function(){if(!cbpPMajaxSubmited){cbpPMajaxSubmited=true;$(this.form).submit()}return true});$("#cbpayOrderContainer").delegate(".cbregconfirmtitleonclick input.cbpaidCCimageInput","click",function(){var title=$(this).attr("title");if(title==""){return true}else{if(confirm($(this).attr("title"))){$("#cbpayOrderContainer>div").fadeTo("fast",0.07).parent().prepend('<div style="position:absolute; z-index:100;" class="cbregAjLoading cbregAjLoadingCentered">&nbsp;</div>').fadeIn("fast");return true}else{return false}}});$("#cbpayOrderContainer").delegate(".cbregCCradioLi:not(.cbregCCradioSelected)","click",function(){if(!cbpPMajaxSubmited){cbpPMajaxSubmited=true;$($(this).find("input:radio.cbpaidCCpaymethod").prop("checked",true)[0].form).submit()}return true});$("input.cbpaidjsSubmit").click(function(){$(this.form).submit()})},paidsubsPlanConditions:function(planId,plansReq,plansNotReq,fieldsReq,fieldsNotReq,field1,regexp1){$.merge(cbpayPlansConds,[{planId:planId,plansReq:plansReq,plansNotReq:plansNotReq,fieldsReq:fieldsReq,fieldsNotReq:fieldsNotReq,field1:field1,regexp1:regexp1}]);for(var j=0;j<fieldsReq.length;j++){var f=$("#cbfv_"+fieldsReq[j]+" input,#cbfv_"+fieldsReq[j]+" select");if((f.attr("type")!="checkbox")&&(f.attr("type")!="radio")){f.change(paidsubsChange)}else{f.click(paidsubsChange)}}for(var j=0;j<fieldsNotReq.length;j++){var f=$("#cbfv_"+fieldsNotReq[j]+" input,#cbfv_"+fieldsNotReq[j]+" select");if((f.attr("type")!="checkbox")&&(f.attr("type")!="radio")){f.change(paidsubsChange)}else{f.click(paidsubsChange)}}if(field1>0){var f=$("#cbfv_"+field1+" input,#cbfv_"+field1+" select");if((f.attr("type")!="checkbox")&&(f.attr("type")!="radio")){f.change(paidsubsChange)}else{f.click(paidsubsChange)}}}}})})(jQuery);