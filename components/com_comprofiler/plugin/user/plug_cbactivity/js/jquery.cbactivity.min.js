!function(e){function t(t){var i=this.jquery?this:e(this);i.off("rebind.cbactivity"),i.off("modified.cbactivity"),i.off("cloned.cbactivity"),i.removeData("cbactivity"),e(document).off("click",t.actinHandler),e(document).off("click",t.displayEditHandler),i.off("click",t.locationHandler),i.off("click",t.cancelNewHandler),i.off("submit",t.saveHandler),i.off("click",t.cancelEditHandler),i.off("click",t.closeNoticeHandler),i.off("click",t.revertNoticeHandler),i.off("click",t.scrollerLeftHandler),i.off("click",t.scrollerRightandler),i.off("click",t.toggleHandler),i.off("change",t.toggleSelectHandler),i.off("click",t.moreHandler),i.off("click",t.displayNewHandler),i.off("keyup input change",t.messageLimitHandler),a.call(i.find(".cbMoreLess"),t).cbmoreless("destroy"),a.call(i.find(".cbRepeat"),t).cbrepeat("destroy"),a.call(i.find(".streamInputAutosize"),t).trigger("autosize.destroy"),a.call(i.find("select.streamInputSelect"),t).cbselect("destroy"),a.call(i.find(".streamInputMessageLimit"),t).remove(),a.call(i.find(".streamItem"),t).each(function(){var t=e(this).data("cbactivity-active-classes"),a=e(this).data("cbactivity-inactive-classes");"undefined"!=typeof t&&e(this).removeClass(t),"undefined"!=typeof a&&e(this).addClass(a)})}function a(t){var a=this.jquery?this:e(this);return a.filter(function(){return e(this).closest(".streamContainer").is(t.element)})}function i(t){var i=this.jquery?this:e(this),l=a.call(i.closest(".streamItem"),t);if(!l.length){var n=i.data("cbactivity-container");"undefined"!=typeof n&&(l=a.call(e(n),t))}return l}function l(t,l){var n=this.jquery?this:e(this);if(l===!0){var s=a.call(n.find(".streamInputMessage"),t);s.each(function(){if(!e(this).siblings(".streamInputMessageLimit").length){var t=e(this).data("cbactivity-input-limit");"undefined"!=typeof t&&(e(this).trigger("change"),e(this).before('<div class="streamInputMessageLimit small hidden"><div class="streamInputMessageLimitCurrent">'+e(this).val().length+'</div> / <div class="streamInputMessageLimitMax">'+t+"</div></div>"))}}),a.call(n.find(".cbMoreLess"),t).cbmoreless(),a.call(n.find(".cbRepeat"),t).cbrepeat(),a.call(n.find("video.streamItemVideo:visible,audio.streamItemAudio:visible"),t).mediaelementplayer();var c=function(t){var a=e(t.element).data("cbactivity-option-icon");return"undefined"!=typeof a?e('<span><span class="cb_template streamSelectOptionIcon">'+a+"</span>"+t.text+"</span>"):t.text};a.call(n.find("select.streamInputSelect"),t).on("cbselect.init.before",function(e,l){if(l.element.val()>0){var n=l.element.data("cbactivity-toggle-target");if("undefined"==typeof n)return;var s=i.call(l.element,t);if(!s.length)return;var c=l.element.find(":selected"),r=c.data("cbactivity-toggle-placeholder"),d=a.call(s.find(n).find(".streamInputSelectToggleLabel"),t);if(d.length&&d.html(c.text()),"undefined"!=typeof r){var o=a.call(s.find(n).find(".streamInputSelectTogglePlaceholder"),t);d.length&&o.attr("placeholder",r)}}}).on("cbselect.init.after",function(e,t){var a=t.element.data("cbactivity-toggle-icon");"undefined"!=typeof a&&t.container.find(".select2-selection").addClass(a)}).cbselect({width:"auto",height:"auto",minimumResultsForSearch:1/0,templateSelection:c,templateResult:c}),n.find('.cbTooltip,[data-hascbtooltip="true"]').cbtooltip()}else a.call(n.find(".streamInputMessageLimit"),t).removeClass("hidden"),a.call(n.find(".streamInputAutosize:visible"),t).trigger("autosize.destroy").autosize({append:"",resizeDelay:0,placeholder:!1}),a.call(n.find(".cbMoreLess"),t).cbmoreless("update"),a.call(n.find("video.streamItemVideo:visible,audio.streamItemAudio:visible"),t).mediaelementplayer();t.element.triggerHandler("cbactivity.bind",[t,n,l])}function n(t){var l=this.jquery?this:e(this),n=i.call(l,t);if(n.length){var s=a.call(n.find(".streamInputMessage"),t),c=e(this).data("cbactivity-input-limit");if("undefined"!=typeof c){var r=e(this).val().length;r>c?e(this).val(e(this).val().substr(0,c)):s.siblings(".streamInputMessageLimit").find(".streamInputMessageLimitCurrent").html(e(this).val().length)}e(this).val()?a.call(n.find(".streamItemNewSave,.streamItemEditSave"),t).removeClass("disabled").prop("disabled",!1):a.call(n.find(".streamItemNewSave,.streamItemEditSave"),t).addClass("disabled").prop("disabled",!0)}}function s(t){var a=this.jquery?this:e(this),n=i.call(a,t);if(n.length){var s=a.siblings(".streamItemScrollContent:not(.hidden)"),c=s.prevAll(".streamItemScrollContent.hidden:first");c.length||(c=a.siblings(".streamItemScrollContent.hidden:last")),c.length&&(c.removeClass("hidden"),s.addClass("hidden"),l.call(n,t))}}function c(t){var a=this.jquery?this:e(this),n=i.call(a,t);if(n.length){var s=a.siblings(".streamItemScrollContent:not(.hidden)"),c=s.nextAll(".streamItemScrollContent.hidden:first");c.length||(c=a.siblings(".streamItemScrollContent.hidden:first")),c.length&&(c.removeClass("hidden"),s.addClass("hidden"),l.call(n,t))}}function r(t){var l=this.jquery?this:e(this),n=i.call(l,t);if(n.length){var s=l.data("cbactivity-location-target"),c=0!=l.data("cbactivity-location-filter");"undefined"!=typeof s&&"undefined"!=typeof navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(e){var i=e.coords.latitude+","+e.coords.longitude,l=n.find(s);c&&(l=a.call(l,t)),l.is("input")?l.val(i):l.html(i)})}}function d(t){var l=this.jquery?this:e(this),n=i.call(l,t);if(n.length){var s=e.fn.cbselect&&"undefined"!=typeof l.data("cbselect"),c=l.data("cbactivity-toggle-target"),r=l.data("cbactivity-toggle-active-classes"),d=l.data("cbactivity-toggle-inactive-classes"),o=0!=l.data("cbactivity-toggle-open"),f=0!=l.data("cbactivity-toggle-close"),m=0!=l.data("cbactivity-toggle-filter"),h=!1;if(s||l.is("select")){var v=l.val();s&&(v=l.cbselect("get")),h=!v||0==v||""==v}else l.hasClass("streamToggleOpen")&&(h=!0);if(h?f&&(l.removeClass("streamToggleOpen"),s&&l.cbselect("container").removeClass("streamToggleOpen"),"undefined"!=typeof r&&(l.removeClass(r),s&&l.cbselect("container").removeClass(r)),"undefined"!=typeof d&&(l.addClass(d),s&&l.cbselect("container").addClass(d)),"undefined"!=typeof c&&(m?(a.call(n.find(c),t).addClass("hidden"),a.call(n.find(c).find("input,textarea,select"),t).prop("disabled",!0)):(n.find(c).addClass("hidden"),n.find(c).find("input,textarea,select").prop("disabled",!0)))):o&&(l.addClass("streamToggleOpen"),s&&l.cbselect("container").addClass("streamToggleOpen"),"undefined"!=typeof r&&(l.addClass(r),s&&l.cbselect("container").addClass(r)),"undefined"!=typeof d&&(l.removeClass(d),s&&l.cbselect("container").removeClass(d)),"undefined"!=typeof c&&(m?(a.call(n.find(c),t).removeClass("hidden"),a.call(n.find(c).find("input,textarea,select"),t).prop("disabled",!1)):(n.find(c).removeClass("hidden"),n.find(c).find("input,textarea,select").prop("disabled",!1)))),l.hasClass("streamInputSelect")&&"undefined"!=typeof c){var u=l.find(":selected"),g=u.data("cbactivity-toggle-placeholder"),p=a.call(n.find(c).find(".streamInputSelectToggleLabel"),t);if(p.length&&p.html(u.text()),"undefined"!=typeof g){var y=a.call(n.find(c).find(".streamInputSelectTogglePlaceholder"),t);p.length&&y.attr("placeholder",g)}}}}function o(t){var n=this.jquery?this:e(this),s=i.call(n,t);if(s.length){var c=n.data("cbactivity-action-target"),r=n.data("cbactivity-action-output"),d=n.data("cbactivity-confirm"),o=n.data("cbactivity-confirm-button"),f=null;"undefined"!=typeof c&&("self"==c?f=n:(c=a.call(s.find(c),t),c.length&&(f=c)));var m=function(){e.ajax({url:n.attr("href"),type:"POST",dataType:"html",beforeSend:function(e,a,i){f?(n.addClass("hidden"),n.after('<span class="streamActionLoading fa fa-spinner fa-pulse"></span>')):s.addClass("overlay"),t.element.triggerHandler("cbactivity.action.send",[t,n,s,e,a,i])},error:function(e,a,i){f?(n.removeClass("hidden"),n.siblings(".streamActionLoading").remove()):s.removeClass("overlay"),t.element.triggerHandler("cbactivity.action.error",[t,n,s,e,a,i])},success:function(a,i,c){var d=null;if(f){switch(d=e(a),n.removeClass("hidden"),n.siblings(".streamActionLoading").remove(),r){case"before":f.before(d);break;case"after":f.after(d);break;case"prepend":f.prepend(d);break;case"append":f.append(d);break;case"replace":default:f.replaceWith(d)}n.remove()}else s.removeClass("overlay"),""!=a?(d=e('<div class="streamItemNotice"><div class="streamItemNoticeMessage">'+a+'</div><a href="javascript:void(0);" class="streamItemNoticeClose"><span class="streamIconClose fa fa-times"></span></a></div>'),s.children().addClass("hidden"),s.children(".streamItemNotice").remove(),s.append(d)):n.hasClass("streamItemNoticeRevert")?(s.children().removeClass("hidden").hide().fadeIn("slow"),s.children(".streamItemNotice").remove()):(s.siblings(".streamItemHeaders").remove(),s.remove());d&&d.hide().fadeIn("slow"),t.element.triggerHandler("cbactivity.action.success",[t,n,s,a,i,c]),d&&l.call(s,t,!0)}})};d?e.cbconfirm(d,{buttonYes:o}).done(m):m()}}function f(t){var a=this.jquery?this:e(this),n=i.call(a,t);if(!n.length)return!1;var s="undefined"==typeof n.data("cbactivity-id"),c=n.data("cbactivity-error-classes");return a.ajaxSubmit({type:"POST",dataType:"html",beforeSend:function(e,i,l){n.addClass("overlay"),c&&n.removeClass(c),t.element.triggerHandler("cbactivity.save.send",[t,a,n,s,e,i,l])},error:function(e,i,l){n.removeClass("overlay"),c&&n.addClass(c),t.element.triggerHandler("cbactivity.save.error",[t,a,n,s,e,i,l])},success:function(i,r,d){n.removeClass("overlay"),c&&n.removeClass(c);var o=e(i);if(s){h.call(a,t);var f=n.siblings(".streamItems");t.settings.direction?o.appendTo(f):o.prependTo(f)}else n.siblings(".streamItemHeaders").remove(),n.replaceWith(o);o.hide().fadeIn("slow"),n=o,t.element.triggerHandler("cbactivity.save.success",[t,a,n,s,i,r,d]),l.call(n,t,!0)}}),!1}function m(t){var n=this.jquery?this:e(this),s=i.call(n,t);if(s.length){var c=a.call(s.find(".streamItemDisplay"),t);if(c.hasClass("hidden")){var r=a.call(s.find(".streamInputMessage"),t),d=r.data("cbactivity-input-size");"undefined"!=typeof d&&r.attr("rows",d),c.removeClass("hidden"),t.element.triggerHandler("cbactivity.new.display",[t,n,s]),l.call(s,t)}}}function h(t){var n=this.jquery?this:e(this),s=i.call(n,t);s.length&&(a.call(s.find(".streamInputMessage"),t).attr("rows",1),a.call(s.find(".streamItemDisplay"),t).addClass("hidden"),a.call(s.find("input,textarea,select"),t).each(function(){var t=e(this).attr("type");if("checkbox"==t||"radio"==t)"radio"==t&&e(this).siblings('input[type="radio"]').length+1==2&&0==e(this).val()?e(this).prop("checked",!0):e(this).prop("checked",!1);else if(e(this).is("select")){var a="";e(this).children('option[value=""]:first').length||e(this).hasClass("streamInputTags")||(a=e(this).children('option[value!=""]:first').val()),e.fn.cbselect&&"undefined"!=typeof e(this).data("cbselect")?e(this).cbselect("set",a):e(this).val(a)}else e(this).val("");e(this).trigger("change")}),a.call(s.find(".streamToggleOpen"),t).each(function(){d.call(this,t)}),a.call(s.find(".cbRepeat"),t).cbrepeat("reset"),t.element.triggerHandler("cbactivity.new.cancel",[t,n,s]),l.call(s,t),a.call(s.find(".streamInputMessageLimit"),t).addClass("hidden"))}function v(t){var n=this.jquery?this:e(this),s=i.call(n,t);s.length&&(a.call(s.find(".streamItemEdit"),t).removeClass("hidden"),a.call(s.find(".streamItemDisplay"),t).addClass("hidden"),t.element.triggerHandler("cbactivity.edit.display",[t,n,s]),l.call(s,t))}function u(t){var n=this.jquery?this:e(this),s=i.call(n,t);s.length&&(a.call(s.find(".streamItemEdit"),t).addClass("hidden"),a.call(s.find(".streamItemDisplay"),t).removeClass("hidden"),t.element.triggerHandler("cbactivity.edit.cancel",[t,n,s]),l.call(s,t))}function g(t){var a=this.jquery?this:e(this);if(!a.hasClass("streamItemAction")){var l=i.call(a,t);l.length&&(l.siblings(".streamItemHeaders").remove(),l.remove(),t.element.triggerHandler("cbactivity.notice.close",[t,a,l]))}}function p(t){var a=this.jquery?this:e(this);if(!a.hasClass("streamItemAction")){var l=i.call(a,t);l.length&&(l.children().removeClass("hidden"),l.children(".streamItemNotice").remove(),t.element.triggerHandler("cbactivity.notice.revert",[t,a,l]))}}function y(t){var i=this.jquery?this:e(this),n=a.call(i.closest(".streamContainer"),t);if(n.length){var s=a.call(n.find(".streamItems"),t),c=i.attr("href");e.ajax({url:c,type:"POST",dataType:"html",beforeSend:function(e,a,l){i.addClass("disabled").prop("disabled",!0).html('<span class="streamIconMoreLoading fa fa-spinner fa-pulse"></span>'),t.element.triggerHandler("cbactivity.more.send",[t,i,n,e,a,l])},error:function(e,a,l){i.remove(),t.element.triggerHandler("cbactivity.more.error",[t,i,n,e,a,l])},success:function(c,r,d){i.remove();var o=e("<div />").html(c);o.find(".streamItem").each(function(){a.call(n.find('.streamItem[data-cbactivity-id="'+e(this).data("cbactivity-id")+'"]'),t).length&&e(this).remove()});var f=e(o.html());t.settings.direction?(f.prependTo(s),a.call(n.find(".streamMore"),t).insertBefore(s)):(f.appendTo(s),a.call(n.find(".streamMore"),t).insertAfter(s)),f.hide().fadeIn("slow"),t.element.triggerHandler("cbactivity.more.success",[t,i,n,c,r,d]),l.call(f,t,!0)}})}}var b=[],I={init:function(a){return this.each(function(){var i=this,I=e(i).data("cbactivity");I||(I={},I.options="undefined"!=typeof a?a:{},I.defaults=e.fn.cbactivity.defaults,I.settings=e.extend(!0,{},I.defaults,I.options),I.element=e(i),I.settings.useData&&e.each(I.defaults,function(e){if("init"!=e&&"useData"!=e){var t=I.element.data("cbactivity"+e.charAt(0).toUpperCase()+e.slice(1));"undefined"!=typeof t?I.settings[e]=t:(t=I.element.data("cbactivity"+e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()),"undefined"!=typeof t&&(I.settings[e]=t))}}),I.element.triggerHandler("cbactivity.init.before",[I]),I.settings.init&&(e.ajaxPrefilter(function(e){e.async=!0}),I.actinHandler=function(e){e.preventDefault(),o.call(this,I)},e(document).delegate(".streamItemAction","click",I.actinHandler),I.displayEditHandler=function(e){e.preventDefault(),v.call(this,I)},e(document).delegate(".streamItemEditDisplay","click",I.displayEditHandler),I.cancelNewHandler=function(e){e.preventDefault(),h.call(this,I)},I.element.delegate(".streamItemNewCancel","click",I.cancelNewHandler),I.saveHandler=function(e){e.preventDefault(),f.call(this,I)},I.element.delegate(".streamItemForm","submit",I.saveHandler),I.cancelEditHandler=function(e){e.preventDefault(),u.call(this,I)},I.element.delegate(".streamItemEditCancel","click",I.cancelEditHandler),I.closeNoticeHandler=function(e){e.preventDefault(),g.call(this,I)},I.element.delegate(".streamItemNoticeClose","click",I.closeNoticeHandler),I.revertNoticeHandler=function(e){e.preventDefault(),p.call(this,I)},I.element.delegate(".streamItemNoticeRevert","click",I.revertNoticeHandler),I.displayNewHandler=function(){m.call(this,I)},I.element.delegate(".streamItemNew .streamInputMessage","click",I.displayNewHandler),I.messageLimitHandler=function(){n.call(this,I)},I.element.delegate(".streamInputMessage","keyup input change",I.messageLimitHandler),I.scrollerLeftHandler=function(e){e.preventDefault(),s.call(this,I)},I.element.delegate(".streamItemScrollLeft","click",I.scrollerLeftHandler),I.scrollerRightandler=function(e){e.preventDefault(),c.call(this,I)},I.element.delegate(".streamItemScrollRight","click",I.scrollerRightandler),I.locationHandler=function(e){e.preventDefault(),r.call(this,I)},I.element.delegate(".streamFindLocation","click",I.locationHandler),I.toggleHandler=function(e){e.preventDefault(),d.call(this,I)},I.element.delegate(".streamToggle","click",I.toggleHandler),I.toggleSelectHandler=function(){d.call(this,I)},I.element.delegate("select.streamInputSelect","change",I.toggleSelectHandler),I.moreHandler=function(e){e.preventDefault(),y.call(this,I)},I.element.delegate(".streamMore","click",I.moreHandler),l.call(i,I,!0),I.element.on("rebind.cbactivity",function(){I.element.cbactivity("rebind")}),I.element.on("modified.cbactivity",function(e,t,a){t!=a&&I.element.cbactivity("rebind")}),I.element.on("cloned.cbactivity",function(){t.call(this,I),e(this).cbactivity(I.options)}),I.element.triggerHandler("cbactivity.init.after",[I]),I.element.data("cbactivity",I),b.push(I)))})},rebind:function(){var t=e(this).data("cbactivity");return t?(t.element.cbactivity("destroy"),t.element.cbactivity(t.options),this):this},destroy:function(){var a=e(this).data("cbactivity");return a?(t.call(a.element,a),a.element.triggerHandler("cbactivity.destroyed",[a]),this):this},instances:function(){return b}};e.fn.cbactivity=function(e){return I[e]?I[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?this:I.init.apply(this,arguments)},e.fn.cbactivity.defaults={init:!0,useData:!0,direction:0}}(jQuery);